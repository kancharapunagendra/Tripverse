<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bangalore Live Traffic | TRIPVERSE IQ</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <style>
      :root {
        --primary: #1d2671;
        --secondary: #ffd166;
        --accent: #4fc3f7;
        --dark: #0c1446;
        --light: #f5f7ff;
        --text: #333;
        --green: #4caf50;
        --yellow: #ffc107;
        --orange: #ff9800;
        --red: #f44336;
        --purple: #9c27b0;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: var(--light);
        min-height: 100vh;
        line-height: 1.6;
        position: relative;
        overflow-x: hidden;
      }

      /* Background image container - you can add your image here */
      .background-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -2;
        background: url("YOUR_IMAGE_URL_HERE") no-repeat center center;
        background-size: cover;
      }

      /* Semi-transparent overlay */
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(13, 19, 57, 0.85);
        z-index: -1;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        background-color: rgba(
          13,
          19,
          57,
          0.7
        ); /* Semi-transparent container */
        backdrop-filter: blur(8px);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        margin-top: 20px;
        margin-bottom: 20px;
      }

      header {
        background: rgba(0, 0, 0, 0.2);
        padding: 20px 40px;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        position: sticky;
        top: 0;
        z-index: 999;
        backdrop-filter: blur(8px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .logo {
        font-weight: bold;
        font-size: 1.8rem;
        letter-spacing: 1px;
        color: white;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo i {
        color: var(--secondary);
      }

      .menu-toggle {
        display: none;
        flex-direction: column;
        cursor: pointer;
        width: 30px;
        height: 22px;
        justify-content: space-between;
      }

      .menu-toggle span {
        height: 4px;
        background: white;
        border-radius: 2px;
        transition: 0.3s;
      }

      nav ul {
        list-style: none;
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
      }

      nav ul li a {
        text-decoration: none;
        color: white;
        font-weight: 500;
        transition: color 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        border-radius: 6px;
      }

      nav ul li a i {
        font-size: 0.9rem;
      }

      nav ul li a:hover,
      nav ul li a.active {
        color: var(--secondary);
        background: rgba(255, 209, 102, 0.1);
      }

      /* Main content */
      .main-title {
        font-size: 2rem;
        margin: 20px 0;
        color: var(--secondary);
        display: flex;
        align-items: center;
        gap: 15px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      /* Route search form */
      .route-form {
        background: rgba(0, 0, 0, 0.5);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 30px;
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .form-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }

      .form-group {
        flex: 1;
        min-width: 250px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.9);
        font-size: 0.95rem;
      }

      .location-input {
        width: 100%;
        padding: 12px 15px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(0, 0, 0, 0.3);
        color: white;
        font-size: 1rem;
        transition: all 0.3s;
      }

      .location-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.2);
      }

      .location-btn {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
      }

      .location-btn:hover {
        background: var(--accent);
        color: var(--dark);
      }

      .input-with-btn {
        display: flex;
        gap: 8px;
      }

      .btn {
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 1rem;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        border: none;
      }

      .btn-primary {
        background: var(--secondary);
        color: var(--dark);
      }

      .btn-primary:hover {
        background: #ffdc73;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 209, 102, 0.3);
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: white;
      }

      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
      }

      /* Traffic legend */
      .traffic-legend {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
        background: rgba(255, 255, 255, 0.1);
        padding: 8px 12px;
        border-radius: 6px;
        backdrop-filter: blur(4px);
      }

      .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 4px;
      }

      /* Traffic map container */
      .traffic-map-container {
        height: 500px;
        border-radius: 14px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
      }

      /* Traffic stats */
      .traffic-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .stat-card {
        background: rgba(0, 0, 0, 0.3);
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid var(--accent);
        backdrop-filter: blur(4px);
      }

      .stat-card h3 {
        font-size: 1.1rem;
        margin-bottom: 15px;
        color: var(--accent);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 5px;
        background: linear-gradient(to right, var(--secondary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .stat-label {
        font-size: 0.9rem;
        opacity: 0.8;
      }

      /* Traffic alerts */
      .traffic-alerts {
        margin-top: 30px;
      }

      .alert-item {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        display: flex;
        align-items: flex-start;
        gap: 12px;
        border-left: 4px solid var(--orange);
        backdrop-filter: blur(4px);
      }

      .alert-item.critical {
        border-left-color: var(--red);
      }

      .alert-item i {
        color: var(--orange);
        font-size: 1.2rem;
        margin-top: 3px;
      }

      .alert-item.critical i {
        color: var(--red);
      }

      .alert-content h4 {
        margin-bottom: 5px;
        font-size: 1.1rem;
      }

      .alert-content p {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      .alert-time {
        font-size: 0.8rem;
        opacity: 0.7;
        margin-top: 5px;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      /* Location suggestions */
      .suggestions-container {
        position: relative;
      }

      .suggestions-list {
        position: absolute;
        width: 100%;
        max-height: 200px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.9);
        border-radius: 0 0 8px 8px;
        z-index: 1000;
        display: none;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-top: none;
      }

      .suggestions-list.show {
        display: block;
      }

      .suggestion-item {
        padding: 10px 15px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .suggestion-item:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      /* Loading state */
      .loading-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px;
        text-align: center;
      }

      .loading-spinner {
        font-size: 3rem;
        margin-bottom: 20px;
        color: var(--accent);
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        font-size: 1.2rem;
        margin-bottom: 20px;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .menu-toggle {
          display: flex;
        }

        nav ul {
          display: none;
          flex-direction: column;
          background: rgba(0, 0, 0, 0.95);
          width: 100%;
          text-align: center;
          position: absolute;
          top: 70px;
          left: 0;
          padding: 20px 0;
        }

        nav ul.show {
          display: flex;
        }

        nav ul li {
          margin: 10px 0;
        }

        .traffic-map-container {
          height: 300px;
        }

        .traffic-stats {
          grid-template-columns: 1fr;
        }

        .form-row {
          flex-direction: column;
          gap: 15px;
        }

        .container {
          margin: 10px;
          padding: 15px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Background container - add your image URL here -->
    <div class="background-container"></div>
    <div class="overlay"></div>

    <header>
      <div class="logo">
        <i class="fas fa-traffic-light"></i>
        TRIPVERSE IQ - BANGALORE TRAFFIC
      </div>
      <div class="menu-toggle" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <nav>
        <ul id="navList">
          <li>
            <a href="index.html"><i class="fas fa-home"></i> Home</a>
          </li>

          <li>
            <a href="traffic congetion.html"
              ><i class="fas fa-traffic-light"></i> Traffic</a
            >
          </li>
          <li>
            <a href="weather .html"><i class="fas fa-cloud-sun"></i> Weather</a>
          </li>
          <li>
            <a href="CAMERA.html"><i class="fas fa-video"></i> Cameras</a>
          </li>
          <li>
            <a href="share pool .html"
              ><i class="fas fa-car-side"></i> Share Pool</a
            >
          </li>

          <li>
            <a href="mood score.html"
              ><i class="fas fa-smile"></i> Mood Score</a
            >
          </li>
          <li>
            <a href="budject.html"
              ><i class="fas fa-calendar-alt"></i> Budget Planner</a
            >
          </li>
        </ul>
      </nav>
    </header>

    <div class="container">
      <h1 class="main-title">
        <i class="fas fa-map-marked-alt"></i>
        Bangalore Traffic Navigator
      </h1>

      <div class="route-form">
        <h2 class="section-title">
          <i class="fas fa-route"></i>
          Plan Your Route
        </h2>

        <div class="form-row">
          <div class="form-group">
            <label for="source-location"
              ><i class="fas fa-map-marker-alt"></i> From</label
            >
            <div class="suggestions-container">
              <div class="input-with-btn">
                <input
                  type="text"
                  id="source-location"
                  class="location-input"
                  placeholder="Current location or address"
                  autocomplete="off"
                />
                <button
                  class="location-btn"
                  onclick="getCurrentLocation('source')"
                >
                  <i class="fas fa-location-arrow"></i>
                </button>
              </div>
              <div class="suggestions-list" id="source-suggestions"></div>
            </div>
          </div>

          <div class="form-group">
            <label for="destination-location"
              ><i class="fas fa-flag-checkered"></i> To</label
            >
            <div class="suggestions-container">
              <input
                type="text"
                id="destination-location"
                class="location-input"
                placeholder="Destination address"
                autocomplete="off"
              />
              <div class="suggestions-list" id="destination-suggestions"></div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <button class="btn btn-primary" onclick="findRoute()">
              <i class="fas fa-search"></i> Find Route
            </button>
            <button class="btn btn-secondary" onclick="clearRoute()">
              <i class="fas fa-redo"></i> Clear
            </button>
          </div>
        </div>
      </div>

      <div id="route-results" style="display: none">
        <!-- Content will be loaded here -->
      </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      // Enhanced Bangalore locations database (200+ locations)
      const bangaloreLocations = [
        { name: "MG Road", coords: [12.9756, 77.5996], type: "major" },
        { name: "Brigade Road", coords: [12.9736, 77.5986], type: "major" },
        { name: "Indiranagar", coords: [12.9786, 77.6406], type: "area" },
        { name: "Koramangala", coords: [12.9346, 77.6266], type: "area" },
        { name: "Whitefield", coords: [12.9696, 77.7496], type: "area" },
        { name: "Marathahalli", coords: [12.9596, 77.6996], type: "area" },
        {
          name: "Silk Board Junction",
          coords: [12.9176, 77.6236],
          type: "junction",
        },
        { name: "Electronic City", coords: [12.8456, 77.6656], type: "area" },
        { name: "Yeshwantpur", coords: [13.0256, 77.5396], type: "area" },
        { name: "Malleswaram", coords: [13.0056, 77.5696], type: "area" },
        { name: "Jayanagar", coords: [12.9306, 77.5836], type: "area" },
        { name: "Banashankari", coords: [12.9256, 77.5496], type: "area" },
        { name: "Hebbal", coords: [13.0356, 77.5996], type: "area" },
        { name: "KR Puram", coords: [13.0056, 77.6996], type: "area" },
        { name: "HSR Layout", coords: [12.9116, 77.6446], type: "area" },
        { name: "BTM Layout", coords: [12.9166, 77.6106], type: "area" },
        { name: "Domlur", coords: [12.9656, 77.6396], type: "area" },
        { name: "Richmond Town", coords: [12.9706, 77.6096], type: "area" },
        { name: "Cubbon Park", coords: [12.9766, 77.5936], type: "landmark" },
        { name: "Lalbagh", coords: [12.9506, 77.5846], type: "landmark" },
        {
          name: "Bangalore Palace",
          coords: [12.9986, 77.5926],
          type: "landmark",
        },
        {
          name: "Vidhana Soudha",
          coords: [12.9796, 77.5906],
          type: "landmark",
        },
        { name: "UB City", coords: [12.9716, 77.5946], type: "landmark" },
        {
          name: "Commercial Street",
          coords: [12.9786, 77.6086],
          type: "major",
        },
        { name: "Church Street", coords: [12.9726, 77.5966], type: "major" },
        { name: "Residency Road", coords: [12.9706, 77.5956], type: "major" },
        { name: "St. Marks Road", coords: [12.9736, 77.5976], type: "major" },
        { name: "Old Airport Road", coords: [12.9616, 77.6496], type: "major" },
        { name: "Outer Ring Road", coords: [12.9816, 77.5846], type: "major" },
        {
          name: "Bannerghatta Road",
          coords: [12.8916, 77.6016],
          type: "major",
        },
        { name: "Hosur Road", coords: [12.9116, 77.6236], type: "major" },
        { name: "Old Madras Road", coords: [12.9916, 77.6746], type: "major" },
        { name: "Bellary Road", coords: [13.0056, 77.5796], type: "major" },
        { name: "Tumkur Road", coords: [13.0256, 77.5096], type: "major" },
        { name: "Mysore Road", coords: [12.9556, 77.5296], type: "major" },
        { name: "Kanakapura Road", coords: [12.9056, 77.5596], type: "major" },
        { name: "Sarjapur Road", coords: [12.9016, 77.6846], type: "major" },
        { name: "Magadi Road", coords: [12.9656, 77.5296], type: "major" },
        { name: "Airport Road", coords: [12.9556, 77.6696], type: "major" },
        {
          name: "100 Feet Road Indiranagar",
          coords: [12.9786, 77.6396],
          type: "major",
        },
        {
          name: "80 Feet Road Koramangala",
          coords: [12.9346, 77.6266],
          type: "major",
        },
        { name: "Double Road", coords: [12.9706, 77.5996], type: "major" },
        { name: "Richmond Road", coords: [12.9706, 77.6096], type: "major" },
        { name: "Lavelle Road", coords: [12.9686, 77.5996], type: "major" },
        { name: "Cunningham Road", coords: [12.9756, 77.5996], type: "major" },
        { name: "Race Course Road", coords: [12.9786, 77.5996], type: "major" },
        { name: "Infantry Road", coords: [12.9786, 77.5996], type: "major" },
        { name: "Palace Road", coords: [12.9986, 77.5926], type: "major" },
        { name: "Sankey Road", coords: [12.9986, 77.5796], type: "major" },
        { name: "Dickenson Road", coords: [12.9756, 77.6296], type: "major" },
        { name: "Queens Road", coords: [12.9756, 77.5996], type: "major" },
        {
          name: "Majestic Bus Stand",
          coords: [12.9776, 77.5696],
          type: "landmark",
        },
        {
          name: "Kempegowda International Airport",
          coords: [13.1986, 77.7066],
          type: "landmark",
        },
        {
          name: "Bangalore City Railway Station",
          coords: [12.9776, 77.5696],
          type: "landmark",
        },
        {
          name: "Yeshwantpur Railway Station",
          coords: [13.0256, 77.5396],
          type: "landmark",
        },
        { name: "KR Market", coords: [12.9626, 77.5766], type: "landmark" },
        {
          name: "Forum Mall Koramangala",
          coords: [12.9346, 77.6266],
          type: "landmark",
        },
        {
          name: "Phoenix Marketcity",
          coords: [12.9996, 77.6966],
          type: "landmark",
        },
        { name: "Orion Mall", coords: [13.0056, 77.5496], type: "landmark" },
        { name: "UB City Mall", coords: [12.9716, 77.5946], type: "landmark" },
        {
          name: "Manyata Tech Park",
          coords: [13.0456, 77.6196],
          type: "landmark",
        },
        {
          name: "Ecospace Business Park",
          coords: [12.9116, 77.6446],
          type: "landmark",
        },
        {
          name: "ITPL Whitefield",
          coords: [12.9696, 77.7496],
          type: "landmark",
        },
        {
          name: "Electronic City Phase 1",
          coords: [12.8456, 77.6656],
          type: "landmark",
        },
        {
          name: "Electronic City Phase 2",
          coords: [12.8356, 77.6756],
          type: "landmark",
        },
        {
          name: "Bagmane Tech Park",
          coords: [12.9786, 77.5996],
          type: "landmark",
        },
        {
          name: "Embassy Golf Links",
          coords: [12.9616, 77.6496],
          type: "landmark",
        },
        {
          name: "Cessna Business Park",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        { name: "RMZ Ecoworld", coords: [12.9116, 77.6446], type: "landmark" },
        {
          name: "Prestige Tech Park",
          coords: [12.9116, 77.6446],
          type: "landmark",
        },
        {
          name: "Salarpuria Sattva Knowledge City",
          coords: [12.9116, 77.6446],
          type: "landmark",
        },
        {
          name: "Divyasree Technopolis",
          coords: [12.9116, 77.6446],
          type: "landmark",
        },
        {
          name: "Embassy Manyata Business Park",
          coords: [13.0456, 77.6196],
          type: "landmark",
        },
        {
          name: "Prestige Shantiniketan",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Bagmane World Technology Center",
          coords: [12.9786, 77.5996],
          type: "landmark",
        },
        { name: "Sobha Quartz", coords: [12.9916, 77.6746], type: "landmark" },
        {
          name: "Sobha Dream Acres",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Prestige Falcon City",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Metropolis",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Gateway",
          coords: [13.0056, 77.5496],
          type: "landmark",
        },
        {
          name: "Brigade Millenium",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Lakefront",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        { name: "Brigade Woods", coords: [12.9916, 77.6746], type: "landmark" },
        {
          name: "Brigade Exotica",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Meadows",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Gardenia",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Springs",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Cosmopolis",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Valencia",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Sanctuary",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade El Dorado",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Lakeview",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Grove",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Meadows",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Springs",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Valley",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Woods",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Gardens",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Haven",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Oasis",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Retreat",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Residency",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Springs",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Terrace",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Villas",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Woods",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Acres",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Gardens",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Haven",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Oasis",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Retreat",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Residency",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Springs",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Terrace",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Villas",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Woods",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Acres",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Gardens",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Haven",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Oasis",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Retreat",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Residency",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Springs",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Terrace",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Villas",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
        {
          name: "Brigade Palm Woods",
          coords: [12.9916, 77.6746],
          type: "landmark",
        },
      ];

      // Enhanced Traffic data for Bangalore routes
      const bangaloreTraffic = [
        {
          name: "MG Road",
          coords: [
            [12.9756, 77.5996],
            [12.9786, 77.6026],
            [12.9816, 77.6056],
          ],
          congestion: 65,
          delay: "15-25 min",
          accidents: 3,
          alerts: [
            "Waterlogging near Trinity Circle",
            "Road work near Anil Kumble Circle",
          ],
          avgSpeed: "12 km/h",
          travelTime: "25 min",
          distance: "5.2 km",
        },
        {
          name: "Outer Ring Road",
          coords: [
            [12.9816, 77.5846],
            [12.9916, 77.5746],
            [13.0016, 77.5646],
          ],
          congestion: 45,
          delay: "10-15 min",
          accidents: 1,
          alerts: ["Slow moving traffic near Marathahalli bridge"],
          avgSpeed: "25 km/h",
          travelTime: "18 min",
          distance: "7.5 km",
        },
        {
          name: "Bannerghatta Road",
          coords: [
            [12.8916, 77.6016],
            [12.9116, 77.6116],
            [12.9316, 77.6216],
          ],
          congestion: 30,
          delay: "5-10 min",
          accidents: 0,
          alerts: [],
          avgSpeed: "32 km/h",
          travelTime: "12 min",
          distance: "6.4 km",
        },
        {
          name: "Hosur Road",
          coords: [
            [12.9116, 77.6236],
            [12.9216, 77.6336],
            [12.9316, 77.6436],
          ],
          congestion: 75,
          delay: "25-35 min",
          accidents: 2,
          alerts: [
            "Accident near Silk Board junction",
            "Heavy congestion near Electronic City",
          ],
          avgSpeed: "8 km/h",
          travelTime: "35 min",
          distance: "4.7 km",
        },
        {
          name: "Old Madras Road",
          coords: [
            [12.9916, 77.6746],
            [12.9816, 77.6646],
            [12.9716, 77.6546],
          ],
          congestion: 25,
          delay: "5-8 min",
          accidents: 0,
          alerts: [],
          avgSpeed: "38 km/h",
          travelTime: "8 min",
          distance: "5.1 km",
        },
        {
          name: "Airport Road",
          coords: [
            [12.9556, 77.6696],
            [12.9656, 77.6596],
            [12.9756, 77.6496],
          ],
          congestion: 50,
          delay: "12-18 min",
          accidents: 1,
          alerts: ["Lane closure near Trinity Circle"],
          avgSpeed: "20 km/h",
          travelTime: "18 min",
          distance: "6.0 km",
        },
        {
          name: "Bellary Road",
          coords: [
            [13.0056, 77.5796],
            [13.0156, 77.5896],
            [13.0256, 77.5996],
          ],
          congestion: 55,
          delay: "15-20 min",
          accidents: 2,
          alerts: [
            "Heavy traffic near Hebbal flyover",
            "Road widening work in progress",
          ],
          avgSpeed: "18 km/h",
          travelTime: "20 min",
          distance: "6.0 km",
        },
        {
          name: "Tumkur Road",
          coords: [
            [13.0256, 77.5096],
            [13.0356, 77.5196],
            [13.0456, 77.5296],
          ],
          congestion: 40,
          delay: "10-12 min",
          accidents: 1,
          alerts: ["Truck breakdown causing delays"],
          avgSpeed: "28 km/h",
          travelTime: "12 min",
          distance: "5.6 km",
        },
        {
          name: "Mysore Road",
          coords: [
            [12.9556, 77.5296],
            [12.9456, 77.5196],
            [12.9356, 77.5096],
          ],
          congestion: 35,
          delay: "8-10 min",
          accidents: 0,
          alerts: [],
          avgSpeed: "30 km/h",
          travelTime: "10 min",
          distance: "5.0 km",
        },
        {
          name: "Kanakapura Road",
          coords: [
            [12.9056, 77.5596],
            [12.8956, 77.5496],
            [12.8856, 77.5396],
          ],
          congestion: 30,
          delay: "6-8 min",
          accidents: 0,
          alerts: [],
          avgSpeed: "35 km/h",
          travelTime: "8 min",
          distance: "4.7 km",
        },
        {
          name: "Sarjapur Road",
          coords: [
            [12.9016, 77.6846],
            [12.9116, 77.6946],
            [12.9216, 77.7046],
          ],
          congestion: 60,
          delay: "18-25 min",
          accidents: 1,
          alerts: ["School zone - reduced speed limits"],
          avgSpeed: "15 km/h",
          travelTime: "25 min",
          distance: "6.2 km",
        },
        {
          name: "Magadi Road",
          coords: [
            [12.9656, 77.5296],
            [12.9556, 77.5196],
            [12.9456, 77.5096],
          ],
          congestion: 25,
          delay: "5-7 min",
          accidents: 0,
          alerts: [],
          avgSpeed: "40 km/h",
          travelTime: "7 min",
          distance: "4.7 km",
        },
        {
          name: "100 Feet Road Indiranagar",
          coords: [
            [12.9786, 77.6396],
            [12.9886, 77.6496],
            [12.9986, 77.6596],
          ],
          congestion: 50,
          delay: "12-15 min",
          accidents: 1,
          alerts: ["Market area - heavy pedestrian traffic"],
          avgSpeed: "22 km/h",
          travelTime: "15 min",
          distance: "5.5 km",
        },
        {
          name: "80 Feet Road Koramangala",
          coords: [
            [12.9346, 77.6266],
            [12.9446, 77.6366],
            [12.9546, 77.6466],
          ],
          congestion: 45,
          delay: "10-12 min",
          accidents: 0,
          alerts: [],
          avgSpeed: "25 km/h",
          travelTime: "12 min",
          distance: "5.0 km",
        },
        {
          name: "Double Road",
          coords: [
            [12.9706, 77.5996],
            [12.9806, 77.6096],
            [12.9906, 77.6196],
          ],
          congestion: 35,
          delay: "8-10 min",
          accidents: 0,
          alerts: [],
          avgSpeed: "30 km/h",
          travelTime: "10 min",
          distance: "5.0 km",
        },
        {
          name: "Richmond Road",
          coords: [
            [12.9706, 77.6096],
            [12.9606, 77.6196],
            [12.9506, 77.6296],
          ],
          congestion: 40,
          delay: "10-12 min",
          accidents: 0,
          alerts: [],
          avgSpeed: "28 km/h",
          travelTime: "12 min",
          distance: "5.6 km",
        },
        {
          name: "Lavelle Road",
          coords: [
            [12.9686, 77.5996],
            [12.9586, 77.5896],
            [12.9486, 77.5796],
          ],
          congestion: 30,
          delay: "6-8 min",
          accidents: 0,
          alerts: [],
          avgSpeed: "35 km/h",
          travelTime: "8 min",
          distance: "4.7 km",
        },
        {
          name: "Cunningham Road",
          coords: [
            [12.9756, 77.5996],
            [12.9656, 77.5896],
            [12.9556, 77.5796],
          ],
          congestion: 35,
          delay: "8-10 min",
          accidents: 0,
          alerts: [],
          avgSpeed: "32 km/h",
          travelTime: "10 min",
          distance: "5.3 km",
        },
        {
          name: "Race Course Road",
          coords: [
            [12.9786, 77.5996],
            [12.9886, 77.6096],
            [12.9986, 77.6196],
          ],
          congestion: 25,
          delay: "5-7 min",
          accidents: 0,
          alerts: [],
          avgSpeed: "40 km/h",
          travelTime: "7 min",
          distance: "4.7 km",
        },
        {
          name: "Infantry Road",
          coords: [
            [12.9786, 77.5996],
            [12.9686, 77.5896],
            [12.9586, 77.5796],
          ],
          congestion: 30,
          delay: "6-8 min",
          accidents: 0,
          alerts: [],
          avgSpeed: "35 km/h",
          travelTime: "8 min",
          distance: "4.7 km",
        },
      ];

      let trafficMap;
      let routeLayer;
      let currentRoute = null;

      // Initialize traffic map
      function initTrafficMap() {
        // Create map centered on Bangalore
        trafficMap = L.map("traffic-map").setView([12.9716, 77.5946], 12);

        // Add base tile layer (OpenStreetMap)
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        }).addTo(trafficMap);

        // Add traffic layer
        routeLayer = L.layerGroup().addTo(trafficMap);

        // Add traffic lights and congestion markers
        addTrafficMarkers();
      }

      // Add traffic markers to the map
      function addTrafficMarkers() {
        // Add traffic lights (simulated)
        const trafficLights = [
          { coords: [12.9756, 77.5996], status: "red" }, // MG Road
          { coords: [12.9736, 77.5986], status: "green" }, // Brigade Road
          { coords: [12.9786, 77.6406], status: "yellow" }, // Indiranagar
          { coords: [12.9346, 77.6266], status: "red" }, // Koramangala
          { coords: [12.9696, 77.7496], status: "green" }, // Whitefield
          { coords: [12.9596, 77.6996], status: "red" }, // Marathahalli
          { coords: [12.9176, 77.6236], status: "yellow" }, // Silk Board
          { coords: [12.8456, 77.6656], status: "green" }, // Electronic City
          { coords: [13.0256, 77.5396], status: "red" }, // Yeshwantpur
          { coords: [13.0056, 77.5696], status: "green" }, // Malleswaram
        ];

        trafficLights.forEach((light) => {
          const icon = L.divIcon({
            html: `<div class="traffic-light" style="background: ${
              light.status === "red"
                ? "#f44336"
                : light.status === "yellow"
                ? "#ffc107"
                : "#4caf50"
            };"></div>`,
            className: "traffic-light-icon",
            iconSize: [20, 20],
          });

          L.marker(light.coords, { icon: icon })
            .addTo(trafficMap)
            .bindPopup(`Traffic Light: ${light.status.toUpperCase()}`);
        });

        // Add congestion markers
        const congestionMarkers = [
          { coords: [12.9756, 77.5996], level: "high" }, // MG Road
          { coords: [12.9736, 77.5986], level: "medium" }, // Brigade Road
          { coords: [12.9786, 77.6406], level: "low" }, // Indiranagar
          { coords: [12.9346, 77.6266], level: "high" }, // Koramangala
          { coords: [12.9696, 77.7496], level: "medium" }, // Whitefield
          { coords: [12.9596, 77.6996], level: "high" }, // Marathahalli
          { coords: [12.9176, 77.6236], level: "very-high" }, // Silk Board
          { coords: [12.8456, 77.6656], level: "medium" }, // Electronic City
          { coords: [13.0256, 77.5396], level: "low" }, // Yeshwantpur
          { coords: [13.0056, 77.5696], level: "medium" }, // Malleswaram
        ];

        congestionMarkers.forEach((marker) => {
          const size =
            marker.level === "very-high"
              ? 25
              : marker.level === "high"
              ? 20
              : marker.level === "medium"
              ? 15
              : 10;

          const color =
            marker.level === "very-high"
              ? "#9c27b0"
              : marker.level === "high"
              ? "#f44336"
              : marker.level === "medium"
              ? "#ff9800"
              : "#ffc107";

          L.circleMarker(marker.coords, {
            radius: size,
            fillColor: color,
            color: "#fff",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.7,
          })
            .addTo(trafficMap)
            .bindPopup(
              `Congestion: ${marker.level.replace("-", " ").toUpperCase()}`
            );
        });
      }

      // Show route on map
      function showRoute(route) {
        // Clear existing routes
        routeLayer.clearLayers();
        currentRoute = route;

        // Add route to map with congestion color
        const color = getCongestionColor(route.congestion);
        const polyline = L.polyline(route.coords, {
          color: color,
          weight: 8,
          opacity: 0.8,
          lineJoin: "round",
        })
          .addTo(routeLayer)
          .bindPopup(
            `<b>${route.name}</b><br>Congestion: ${route.congestion}%<br>Delay: ${route.delay}`
          );

        // Add markers for start and end points
        L.circleMarker(route.coords[0], {
          radius: 8,
          fillColor: color,
          color: "#fff",
          weight: 2,
          opacity: 1,
          fillOpacity: 0.8,
        })
          .addTo(trafficMap)
          .bindPopup(
            "Start: " + document.getElementById("source-location").value
          );

        L.circleMarker(route.coords[route.coords.length - 1], {
          radius: 8,
          fillColor: color,
          color: "#fff",
          weight: 2,
          opacity: 1,
          fillOpacity: 0.8,
        })
          .addTo(trafficMap)
          .bindPopup(
            "End: " + document.getElementById("destination-location").value
          );

        // Fit map to route bounds
        trafficMap.fitBounds(polyline.getBounds());

        // Update stats
        updateRouteStats(route);

        // Show route alerts
        showRouteAlerts(route);

        // Add traffic events along the route
        addTrafficEvents(route);
      }

      // Add traffic events along the route
      function addTrafficEvents(route) {
        // Simulate traffic events (accidents, construction, etc.)
        const events = [
          {
            coords: interpolatePoint(route.coords, 0.3),
            type: "accident",
            severity: "medium",
            description: "Minor accident reported",
          },
          {
            coords: interpolatePoint(route.coords, 0.7),
            type: "construction",
            severity: "low",
            description: "Road work in progress",
          },
        ];

        events.forEach((event) => {
          const icon = L.divIcon({
            html: `<div class="traffic-event" style="background: ${
              event.severity === "high"
                ? "#f44336"
                : event.severity === "medium"
                ? "#ff9800"
                : "#ffc107"
            };">
            <i class="fas fa-${
              event.type === "accident"
                ? "car-crash"
                : event.type === "construction"
                ? "road"
                : "exclamation-triangle"
            }"></i>
          </div>`,
            className: "traffic-event-icon",
            iconSize: [25, 25],
          });

          L.marker(event.coords, { icon: icon })
            .addTo(trafficMap)
            .bindPopup(`<b>Traffic Event</b><br>${event.description}`);
        });
      }

      // Helper function to interpolate a point along the route
      function interpolatePoint(coords, fraction) {
        const totalDistance = getRouteLength(coords);
        let accumulatedDistance = 0;

        for (let i = 1; i < coords.length; i++) {
          const segmentDistance = getDistance(coords[i - 1], coords[i]);
          if (
            accumulatedDistance + segmentDistance >=
            totalDistance * fraction
          ) {
            const segmentFraction =
              (totalDistance * fraction - accumulatedDistance) /
              segmentDistance;
            return [
              coords[i - 1][0] +
                (coords[i][0] - coords[i - 1][0]) * segmentFraction,
              coords[i - 1][1] +
                (coords[i][1] - coords[i - 1][1]) * segmentFraction,
            ];
          }
          accumulatedDistance += segmentDistance;
        }

        return coords[coords.length - 1];
      }

      // Helper function to calculate distance between two points
      function getDistance(point1, point2) {
        const R = 6371; // Radius of the Earth in km
        const dLat = ((point2[0] - point1[0]) * Math.PI) / 180;
        const dLon = ((point2[1] - point1[1]) * Math.PI) / 180;
        const a =
          Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos((point1[0] * Math.PI) / 180) *
            Math.cos((point2[0] * Math.PI) / 180) *
            Math.sin(dLon / 2) *
            Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c;
      }

      // Helper function to calculate total route length
      function getRouteLength(coords) {
        let total = 0;
        for (let i = 1; i < coords.length; i++) {
          total += getDistance(coords[i - 1], coords[i]);
        }
        return total;
      }

      // Get color based on congestion percentage
      function getCongestionColor(congestion) {
        if (congestion >= 80) return "var(--purple)";
        if (congestion >= 60) return "var(--red)";
        if (congestion >= 40) return "var(--orange)";
        if (congestion >= 20) return "var(--yellow)";
        return "var(--green)";
      }

      // Update route statistics
      function updateRouteStats(route) {
        document.getElementById("estimated-time").textContent = route.delay;
        document.getElementById("carbon-emission").textContent = `${(
          route.congestion / 20
        ).toFixed(1)} kg`;
        document.getElementById("accident-risk").textContent = `${Math.min(
          100,
          route.accidents * 15
        )}%`;
        document.getElementById("fuel-cost").textContent = `â‚¹${Math.round(
          route.congestion * 1.2
        )}`;
      }

      // Show route alerts
      function showRouteAlerts(route) {
        const alertsContainer = document.getElementById("route-alerts");

        if (route.alerts.length === 0) {
          alertsContainer.innerHTML = `
          <div class="alert-item">
            <i class="fas fa-check-circle" style="color: var(--green)"></i>
            <div class="alert-content">
              <h4>No Major Alerts</h4>
              <p>No significant traffic issues reported on this route</p>
            </div>
          </div>
        `;
        } else {
          alertsContainer.innerHTML = route.alerts
            .map(
              (alert) => `
          <div class="alert-item ${
            alert.includes("Accident") ? "critical" : ""
          }">
            <i class="fas fa-${
              alert.includes("Accident")
                ? "exclamation-circle"
                : "exclamation-triangle"
            }"></i>
            <div class="alert-content">
              <h4>${
                alert.includes("Accident") ? "Accident Alert" : "Traffic Alert"
              }</h4>
              <p>${alert}</p>
              <div class="alert-time">
                <i class="fas fa-clock"></i> Updated just now
              </div>
            </div>
          </div>
        `
            )
            .join("");
        }
      }

      // Find route between locations
      function findRoute() {
        const source = document.getElementById("source-location").value;
        const destination = document.getElementById(
          "destination-location"
        ).value;

        if (!source || !destination) {
          alert("Please enter both starting point and destination");
          return;
        }

        // Show loading state
        document.getElementById("route-results").style.display = "block";
        document.getElementById("route-results").innerHTML = `
        <div class="loading-container">
          <div class="loading-spinner">
            <i class="fas fa-spinner"></i>
          </div>
          <div class="loading-text">Finding best route and analyzing traffic conditions...</div>
        </div>
      `;

        // Simulate API call delay
        setTimeout(() => {
          // Find matching locations (case insensitive partial match)
          const sourceMatch = bangaloreLocations.find((loc) =>
            loc.name.toLowerCase().includes(source.toLowerCase())
          );
          const destMatch = bangaloreLocations.find((loc) =>
            loc.name.toLowerCase().includes(destination.toLowerCase())
          );

          if (!sourceMatch || !destMatch) {
            document.getElementById("route-results").innerHTML = `
            <div class="alert-item critical">
              <i class="fas fa-exclamation-circle"></i>
              <div class="alert-content">
                <h4>Location Not Found</h4>
                <p>Could not find locations. Please try more specific names or check spelling.</p>
              </div>
            </div>
          `;
            return;
          }

          // Find the best matching route (simplified for demo)
          // In a real app, this would use a proper routing algorithm
          let route = null;

          // First try to find a route that connects the areas
          for (const rt of bangaloreTraffic) {
            if (
              rt.name.includes(sourceMatch.name.split(" ")[0]) ||
              rt.name.includes(destMatch.name.split(" ")[0])
            ) {
              route = JSON.parse(JSON.stringify(rt)); // Deep clone
              break;
            }
          }

          // If no direct route found, use the first traffic route as default
          if (!route) {
            route = JSON.parse(JSON.stringify(bangaloreTraffic[0]));
          }

          // Update the route coords to include our points
          route.coords = [
            sourceMatch.coords,
            ...route.coords,
            destMatch.coords,
          ];

          // Update route name to reflect start and end points
          route.name = `${sourceMatch.name} to ${destMatch.name}`;

          // Show the full results
          showFullResults(route, sourceMatch, destMatch);
        }, 1500);
      }

      // Show full results after route is found
      function showFullResults(route, sourceMatch, destMatch) {
        document.getElementById("route-results").innerHTML = `
        <div class="card">
          <h2 class="section-title">
            <i class="fas fa-traffic-light"></i>
            Live Traffic Conditions
          </h2>

          <div class="traffic-legend">
            <div class="legend-item">
              <div class="legend-color" style="background: var(--green);"></div>
              <span>Clear (0-20% congestion)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: var(--yellow);"></div>
              <span>Moderate (20-40%)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: var(--orange);"></div>
              <span>Heavy (40-60%)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: var(--red);"></div>
              <span>Severe (60-80%)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: var(--purple);"></div>
              <span>Gridlock (80-100%)</span>
            </div>
          </div>

          <div class="traffic-map-container" id="traffic-map">
            <div style="position: absolute; top: 10px; right: 10px; z-index: 1000; background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 4px; color: white; font-size: 0.9rem;">
              <i class="fas fa-info-circle"></i> Click on roads for details
            </div>
          </div>

          <div class="traffic-stats">
            <div class="stat-card">
              <h3><i class="fas fa-clock"></i> Estimated Time</h3>
              <div class="stat-value" id="estimated-time">${route.delay}</div>
              <div class="stat-label">Based on current traffic</div>
            </div>

            <div class="stat-card">
              <h3><i class="fas fa-co2"></i> Carbon Emission</h3>
              <div class="stat-value" id="carbon-emission">${(
                route.congestion / 20
              ).toFixed(1)} kg</div>
              <div class="stat-label">Estimated for this route</div>
            </div>

            <div class="stat-card">
              <h3><i class="fas fa-car-crash"></i> Accident Risk</h3>
              <div class="stat-value" id="accident-risk">${Math.min(
                100,
                route.accidents * 15
              )}%</div>
              <div class="stat-label">On this route currently</div>
            </div>

            <div class="stat-card">
              <h3><i class="fas fa-bolt"></i> Fuel Cost</h3>
              <div class="stat-value" id="fuel-cost">â‚¹${Math.round(
                route.congestion * 1.2
              )}</div>
              <div class="stat-label">Estimated fuel consumption</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h2 class="section-title">
            <i class="fas fa-exclamation-triangle"></i>
            Route Alerts
          </h2>

          <div class="traffic-alerts" id="route-alerts">
            ${
              route.alerts.length === 0
                ? `
              <div class="alert-item">
                <i class="fas fa-check-circle" style="color: var(--green)"></i>
                <div class="alert-content">
                  <h4>No Major Alerts</h4>
                  <p>No significant traffic issues reported on this route</p>
                </div>
              </div>
            `
                : route.alerts
                    .map(
                      (alert) => `
              <div class="alert-item ${
                alert.includes("Accident") ? "critical" : ""
              }">
                <i class="fas fa-${
                  alert.includes("Accident")
                    ? "exclamation-circle"
                    : "exclamation-triangle"
                }"></i>
                <div class="alert-content">
                  <h4>${
                    alert.includes("Accident")
                      ? "Accident Alert"
                      : "Traffic Alert"
                  }</h4>
                  <p>${alert}</p>
                  <div class="alert-time">
                    <i class="fas fa-clock"></i> Updated just now
                  </div>
                </div>
              </div>
            `
                    )
                    .join("")
            }
          </div>
        </div>

        <div class="card">
          <h2 class="section-title">
            <i class="fas fa-lightbulb"></i>
            Smart Suggestions
          </h2>

          <div class="traffic-alerts" id="smart-suggestions">
            <div class="alert-item">
              <i class="fas fa-clock"></i>
              <div class="alert-content">
                <h4>Best Time to Travel</h4>
                <p>Leave before 7:30 AM or after 10:30 AM to avoid peak traffic</p>
              </div>
            </div>
            <div class="alert-item">
              <i class="fas fa-subway"></i>
              <div class="alert-content">
                <h4>Alternative Transport</h4>
                <p>Consider taking Metro from ${
                  sourceMatch.name.includes("Road")
                    ? sourceMatch.name
                    : "nearest station"
                } to ${
          destMatch.name.includes("Road") ? destMatch.name : "nearest station"
        }</p>
              </div>
            </div>
            <div class="alert-item">
              <i class="fas fa-route"></i>
              <div class="alert-content">
                <h4>Alternate Route</h4>
                <p>Take ${
                  route.name.includes("Hosur")
                    ? "Bannerghatta Road"
                    : "Old Madras Road"
                } for 5 minutes longer but 30% less congestion</p>
              </div>
            </div>
          </div>
        </div>
      `;

        // Reinitialize the map with the route
        initTrafficMap();
        showRoute(route);
      }

      // Clear current route
      function clearRoute() {
        document.getElementById("source-location").value = "";
        document.getElementById("destination-location").value = "";
        document.getElementById("route-results").style.display = "none";

        if (trafficMap) {
          routeLayer.clearLayers();
          // Reinitialize map to show default traffic view
          initTrafficMap();
        }
      }

      // Get current location
      function getCurrentLocation(field) {
        const input = document.getElementById(
          field === "source" ? "source-location" : "destination-location"
        );

        input.value = "Detecting location...";

        // Simulate geolocation
        setTimeout(() => {
          // Find the nearest location to the center of Bangalore
          const center = [12.9716, 77.5946];
          let nearestLocation = bangaloreLocations[0];
          let minDistance = getDistance(center, nearestLocation.coords);

          for (const loc of bangaloreLocations) {
            const dist = getDistance(center, loc.coords);
            if (dist < minDistance) {
              minDistance = dist;
              nearestLocation = loc;
            }
          }

          input.value = nearestLocation.name;

          // Show nearby suggestions
          if (field === "source") {
            showLocationSuggestions(input.value, "source-suggestions");
          }
        }, 1000);
      }

      // Show location suggestions
      function showLocationSuggestions(query, containerId) {
        const container = document.getElementById(containerId);

        if (!query || query.length < 2) {
          container.classList.remove("show");
          return;
        }

        const queryLower = query.toLowerCase();
        const matches = bangaloreLocations.filter(
          (loc) =>
            loc.name.toLowerCase().includes(queryLower) ||
            loc.type.toLowerCase().includes(queryLower)
        );

        if (matches.length > 0) {
          container.innerHTML = matches
            .slice(0, 8)
            .map(
              (loc) => `
          <div class="suggestion-item" onclick="selectSuggestion('${
            loc.name
          }', '${containerId}')">
            <i class="fas fa-${
              loc.type === "major"
                ? "road"
                : loc.type === "landmark"
                ? "monument"
                : "map-marker-alt"
            }"></i>
            ${loc.name}
          </div>
        `
            )
            .join("");
          container.classList.add("show");
        } else {
          container.classList.remove("show");
        }
      }

      // Select a suggestion
      function selectSuggestion(value, containerId) {
        const field = containerId.includes("source")
          ? "source-location"
          : "destination-location";
        document.getElementById(field).value = value;
        document.getElementById(containerId).classList.remove("show");
      }

      // Mobile menu toggle
      function toggleMenu() {
        const navList = document.getElementById("navList");
        navList.classList.toggle("show");
      }

      // Initialize the page
      document.addEventListener("DOMContentLoaded", function () {
        // Set up event listeners for location suggestions
        document
          .getElementById("source-location")
          .addEventListener("input", function () {
            showLocationSuggestions(this.value, "source-suggestions");
          });

        document
          .getElementById("destination-location")
          .addEventListener("input", function () {
            showLocationSuggestions(this.value, "destination-suggestions");
          });

        // Close suggestions when clicking elsewhere
        document.addEventListener("click", function (e) {
          if (!e.target.closest(".suggestions-container")) {
            document
              .getElementById("source-suggestions")
              .classList.remove("show");
            document
              .getElementById("destination-suggestions")
              .classList.remove("show");
          }
        });

        // Initialize map
        initTrafficMap();

        // Simulate real-time traffic updates
        setInterval(() => {
          if (currentRoute) {
            // Randomly adjust congestion (-5% to +10%)
            const change = Math.floor(Math.random() * 16) - 5;
            currentRoute.congestion = Math.min(
              100,
              Math.max(0, currentRoute.congestion + change)
            );

            // Update delay estimate
            const delayChange = Math.floor(Math.random() * 3) - 1; // -1, 0, or +1
            const [min, max] = currentRoute.delay
              .split(/-| /)
              .map((s) => parseInt(s))
              .filter((n) => !isNaN(n));
            if (min && max) {
              currentRoute.delay = `${Math.max(
                1,
                min + delayChange
              )}-${Math.max(1, max + delayChange)} min`;
            }

            // Randomly add/remove alerts
            if (Math.random() > 0.7) {
              if (currentRoute.alerts.length > 0 && Math.random() > 0.5) {
                currentRoute.alerts.pop();
              } else {
                const newAlerts = [
                  "Road work causing delays",
                  "Vehicle breakdown reported",
                  "Waterlogging on road",
                  "Protest march affecting traffic",
                  "Festival causing heavy traffic",
                  "Accident reported ahead",
                  "Lane closure due to construction",
                  "Traffic signal not working",
                  "Heavy vehicle congestion",
                  "Pedestrian crossing busy",
                ];
                currentRoute.alerts.push(
                  newAlerts[Math.floor(Math.random() * newAlerts.length)]
                );
              }
            }

            // Update the display
            updateRouteStats(currentRoute);
            showRouteAlerts(currentRoute);

            // Update the map polyline color
            routeLayer.clearLayers();
            const color = getCongestionColor(currentRoute.congestion);
            const polyline = L.polyline(currentRoute.coords, {
              color: color,
              weight: 8,
              opacity: 0.8,
              lineJoin: "round",
            }).addTo(routeLayer);
          }
        }, 30000); // Update every 30 seconds
      });
    </script>
  </body>
</html>
